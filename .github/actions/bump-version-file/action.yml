name: Bump Version File
description: Increments a version file.
inputs:
  version-file-path:
    description: The path to the version file.
    required: true
  release-type:
    description: Type of release. Must be one of `patch`, `minor`, `major`.
    required: true

runs:
  using: composite
  steps:
    - name: Get Current Version
      id: current
      shell: bash
      run: |
        echo "::set-output name=current_version::$(grep -Eo '([0-9]+\.*)+' ${{ inputs.version-file-path }})"

    - name: Bump Version
      id: bump
      shell: bash
      run: |
        echo "::set-output name=new_version::$( ./semver.sh bump ${{ inputs.release-type }} ${{ current.outputs.current_version }})"

    - name: Update Version File
      shell: bash
      run: |
        TEMPLATE=`cat <<EOF
        enum Version {
          static let number = "${{ bump.outputs.new_version }}"
        }
        `
        echo "$TEMPLATE" > ${{ inputs.version-file-path }}
